!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/add/operator/first"),require("redux"),require("immutable"),require("redux-localstorage"),require("transit-immutable-js"),require("redux-logger"),require("rxjs/Observable"),require("rxjs/add/operator/takeUntil"),require("@angular-redux/store"),require("@ngx-translate/core"),require("@angular/common/http"),require("normalizr"),require("rxjs/add/operator/catch"),require("rxjs/add/operator/map"),require("rxjs/add/operator/share"),require("rxjs/BehaviorSubject"),require("rxjs/add/operator/distinctUntilChanged"),require("redux-immutable"),require("redux-batched-actions"),require("redux-observable"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/observable/empty"),require("@angular-redux/router"),require("reselect"),require("ajv"),require("validator"),require("date-fns")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/add/operator/first","redux","immutable","redux-localstorage","transit-immutable-js","redux-logger","rxjs/Observable","rxjs/add/operator/takeUntil","@angular-redux/store","@ngx-translate/core","@angular/common/http","normalizr","rxjs/add/operator/catch","rxjs/add/operator/map","rxjs/add/operator/share","rxjs/BehaviorSubject","rxjs/add/operator/distinctUntilChanged","redux-immutable","redux-batched-actions","redux-observable","rxjs/add/operator/mergeMap","rxjs/add/observable/empty","@angular-redux/router","reselect","ajv","validator","date-fns"],t):t((e.dcs=e.dcs||{},e.dcs["ngx-utils"]={}),e.ng.core,e.Rx.Observable.prototype,e.Redux,e.Immutable,e.persistState,e.transit,e.reduxLogger,e.Rx,e.Rx.Observable.prototype,e.store,e.core$1,e.ng.common.http,e.normalizr,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx,e.Rx.Observable.prototype,e.reduxImmutable,e.reduxBatchedActions,e.reduxObservable,e.Rx.Observable.prototype,e.Rx.Observable,e.router,e.reselect,e.Ajv,e.validator,e.DateFns)}(this,function(e,t,r,n,o,a,i,u,s,c,d,l,p,f,h,g,v,y,m,b,S,E,R,x,O,_,j,w,A){"use strict";a=a&&a.hasOwnProperty("default")?a["default"]:a,i=i&&i.hasOwnProperty("default")?i["default"]:i,j=j&&j.hasOwnProperty("default")?j["default"]:j;var T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};function P(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function N(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=a["return"])&&r.call(a)}finally{if(o)throw o.error}}return i}function q(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(N(arguments[t]));return e}function M(e,t){var r=t?t.toLocaleUpperCase()+"_"+e.toLocaleUpperCase():e.toLocaleUpperCase(),n="START",o="NEXT",a="ERROR",i=r+"_READ",u=r+"_READ_ONE",s=r+"_CREATE",c=r+"_UPDATE",d=r+"_DELETE";return{read:i,readStart:i+"_"+n,readNext:i+"_"+o,readNextUpdate:i+"_"+o+"_UPDATE",readError:i+"_"+a,readOne:u,readOneStart:u+"_"+n,readOneNext:u+"_"+o,readOneNextUpdate:u+"_"+o+"_UPDATE",readOneError:u+"_"+a,create:s,createStart:s+"_"+n,createNext:s+"_"+o,createError:s+"_"+a,update:c,updateStart:c+"_"+n,updateNext:c+"_"+o,updateError:c+"_"+a,"delete":d,deleteStart:d+"_"+n,deleteNext:d+"_"+o,deleteError:d+"_"+a,setCurrent:r+"_SET_CURRENT",reset:r+"_RESET",resetError:r+"_RESET_ERROR"}}function D(e,t){void 0===t&&(t=0);var r=e.get("updatedAt");return 0===r||Date.now()-r-t>0}var C=function(){function e(){this.subscriptions=[]}return e.prototype.ngOnDestroy=function(){this.subscriptions.forEach(function(e){e.unsubscribe()}),this.subscriptions=[]},e.prototype.subscribeToObservable=function(e,t){this.subscriptions.push(e.subscribe(t.bind(this)))},e.prototype.valueFromObservable=function(e,t){var r=this;this.subscribeToObservable(e,function(e){r[t]=e})},e.prototype.executeIfStateStale=function(e,t,r){e.first().subscribe(function(e){D(e,t)&&r()})},e}();C.decorators=[{type:t.Injectable}],C.ctorParameters=function(){return[]};var I=function(){function e(){}return e.prototype.identify=function(e,t){if("function"!=typeof t.hashCode)throw new TypeError("Given item is not of type Immutable, "+t.toString()+" given!");return t.hashCode()},e.prototype.hasError=function(e,t,r){var n=e.get(t);return!n.untouched&&(r?!(!n.errors||!n.errors[r]):!!n.errors)},e}();function L(e,t,r,a){return void 0===t&&(t=o.fromJS({})),void 0===r&&(r=[]),void 0===a&&(a=[]),n.createStore(e,t,n.compose.apply(void 0,q([n.applyMiddleware.apply(void 0,q(r))],a)))}function U(e){return e.get("router")}var z=function(e){return function(t){return function(r){if(!(r.payload instanceof s.Observable))return t(r);var n=r.type,o=r.payload;r.meta&&r.meta.cancel&&(o=o.takeUntil(r.meta.cancel)),e.dispatch({type:n+"_START",meta:r.meta}),o.subscribe(function(t){return e.dispatch({type:n+"_NEXT",payload:t,meta:r.meta})},function(t){return e.dispatch({type:n+"_ERROR",payload:t,meta:r.meta})},function(){r.meta&&r.meta.dispatchCompleted&&e.dispatch({type:n+"_COMPLETED"})})}}},J=u.createLogger({stateTransformer:function(e){return e.toJS?e.toJS():e}}),F=function(e){return function(e){return function(t){if(t&&t.type)return e(t)}}},k=function(){function e(e,t,r,n,o,a,i){var u;this.store=e,this.devTools=t,this.rootReducer=r,this.rootEpic=n,this.ngReduxRouter=o,this.environment=a,this.stableService=i,module.hot&&window.hmrData&&(u=window.hmrData.appState,delete window.hmrData),this.setupStore(u),this.ngReduxRouter.initialize(U)}return e.prototype.setupStore=function(e){void 0===e&&(e=o.Map({}));var t=L(this.rootReducer.reducer(),o.fromJS(e),this.getMiddleware(),this.getEnhancers());this.store.provideStore(t),this.stableService.init()},e.prototype.getMiddleware=function(){var e=[F,z,this.rootEpic.middleware];return this.environment.additionalMiddleware&&(e=q(e,this.environment.additionalMiddleware)),e},e.prototype.getEnhancers=function(){var e=[];return this.environment.additionalEnhancers&&(e=q(e,this.environment.additionalEnhancers)),!this.environment.production&&this.devTools.isEnabled()&&(e=q(e,[this.devTools.enhancer()])),e},e}(),V=new t.InjectionToken("APP_REDUCERS"),B=new t.InjectionToken("APP_EPICS"),$=new t.InjectionToken("APP_ERROR_FORMATTERS"),H=new t.InjectionToken("APP_TRANSLATIONS"),W=new t.InjectionToken("APP_ENVIRONMENT"),Y=function(){function e(){}return e.prototype.setLocale=function(e){return{type:"TRANSLATE_SET_LOCALE",payload:e}},e}();Y.decorators=[{type:t.Injectable}],Y.ctorParameters=function(){return[]},function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);a>3&&i&&Object.defineProperty(t,r,i)}([d.dispatch(),P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",Object)],Y.prototype,"setLocale",null);var Q=function(){function e(e,t){this.translateActions=e,this.translateService=t}return e.prototype.setup=function(){var e=this;this.translateService.onLangChange.subscribe(function(t){e.translateActions.setLocale(t.lang)})},e}();Q.decorators=[{type:t.Injectable}],Q.ctorParameters=function(){return[{type:Y},{type:l.TranslateService}]};var X=function(){function e(e,t,r){this.translate=e,this.appLocale=t,this.translations=r,this.setupTranslations()}return e.prototype.setupTranslations=function(){var e=this;this.translations.forEach(function(t){e.translate.setTranslation(t.name,t.translations,!0)}),this.translate.setDefaultLang(this.appLocale),this.translate.use(this.appLocale)},e}();X.decorators=[{type:t.NgModule,args:[{exports:[l.TranslateModule],imports:[l.TranslateModule.forRoot()],providers:[Y,Q,{provide:H,useValue:{name:"en",translations:{}},multi:!0}]}]}],X.ctorParameters=function(){return[{type:l.TranslateService},{type:undefined,decorators:[{type:t.Inject,args:[t.LOCALE_ID]}]},{type:Array,decorators:[{type:t.Inject,args:[H]}]}]};var G=function(){function e(e,t){this.http=e,this.environment=t,this._activeRequests=0}return Object.defineProperty(e.prototype,"activeRequests",{get:function(){return this._activeRequests},set:function(e){this._activeRequests=e},enumerable:!0,configurable:!0}),e.prototype.get=function(e,t,r,n){return void 0===t&&(t={}),this.request("get",e,t,r,n)},e.prototype.post=function(e,t,r,n,o){return void 0===r&&(r={}),r=Object.assign({},r,{body:t}),this.request("post",e,r,n,o)},e.prototype.put=function(e,t,r,n,o){return void 0===r&&(r={}),r=Object.assign({},r,{body:t}),this.request("put",e,r,n,o)},e.prototype["delete"]=function(e,t,r,n){return void 0===t&&(t={}),this.request("delete",e,t,r,n)},e.prototype.request=function(e,t,r,n,o){var a=this,i=this.getUrl(t);return r=this.buildRequestOptions(r),this.activeRequests++,this.http.request(e,i,r).map(function(e){if(o&&(!o(e)&&(a.logSchemaErrors(o.errors,e,t,r),a.environment.throwOnSchemaError)))throw new Error("Schema validation failed");return e}).map(function(e){return a.normalizePayload(e,n)}).map(function(e){return a.activeRequests--,e})["catch"](function(e){throw a.activeRequests--,e}).share()},e.prototype.logSchemaErrors=function(e,t,r,n){if(e&&e.length){var o="color: red; background-color: #ffe6e6; border: 1px solid #ff9999; padding: 1px 10px";console.group("%cSchema validation failed",o),console.log("Request:",r,n),console.log("Response Data:",t),console.group("%cErrors:",o),e.forEach(function(e){console.log(e)}),console.groupEnd(),console.groupEnd()}},e.prototype.getUrl=function(e){return e.startsWith("http")||e.startsWith("//")?e:this.environment.apiUrl+"/"+e},e.prototype.normalizePayload=function(e,t){return t?f.normalize(e,t):e},e.prototype.extractResponseData=function(e){var t;try{t=e.json()}catch(r){t={}}return t},e.prototype.buildRequestOptions=function(e){return e},e}();G.decorators=[{type:t.Injectable}],G.ctorParameters=function(){return[{type:p.HttpClient},{type:undefined,decorators:[{type:t.Inject,args:[W]}]}]};var K=function(){function e(e,t){this.http=e,this.store=t,this.onStoreStable$=new y.BehaviorSubject(!1),this.storeStable$=this.onStoreStable$.distinctUntilChanged()}return e.prototype.init=function(){var e=this;this.store.subscribe(function(){window.storeStable=!1,e.onStoreStable$.next(!1),0===e.http.activeRequests&&(window.storeStable=!0,e.onStoreStable$.next(!0))})},e}();K.decorators=[{type:t.Injectable}],K.ctorParameters=function(){return[{type:G},{type:d.NgRedux}]};var Z=function(){function e(e){this.reducerConfigs=e,this.currentReducers={}}return e.prototype.reducer=function(e){return S.enableBatching(b.combineReducers(this.buildReducers(e)))},e.prototype.buildReducers=function(e){var t=Object.assign({},this.currentReducers),r=e||this.reducerConfigs;return this.currentReducers=r.reduce(function(e,t){return"function"==typeof t.reducer.reducer?e[t.name]=t.reducer.reducer():e[t.name]=t.reducer,e},t),this.currentReducers},e}();function ee(e){return e.mergeMap(function(){return s.Observable.empty()})}Z.decorators=[{type:t.Injectable}],Z.ctorParameters=function(){return[{type:Array,decorators:[{type:t.Inject,args:[V]}]}]};var te=function(){function e(e){this.epicConfigs=e;var t=this.buildEpics(e);this.middleware=E.createEpicMiddleware(E.combineEpics.apply(void 0,q(t)))}return e.prototype.epic=function(){return E.combineEpics.apply(void 0,q(this.epicConfigs))},e.prototype.buildEpics=function(e){return e.map(function(e){return e.epic?e.epic():e})},e}();te.decorators=[{type:t.Injectable}],te.ctorParameters=function(){return[{type:Array,decorators:[{type:t.Inject,args:[B]}]}]};var re={name:"router",reducer:O.routerReducer},ne=ee,oe=function(){return function(){}}();oe.decorators=[{type:t.NgModule,args:[{providers:[Z,te,{multi:!0,provide:V,useValue:re},{provide:B,useValue:ne,multi:!0}]}]}],oe.ctorParameters=function(){return[]};var ae=function(){return function(){}}();function ie(e){return o.fromJS(e)}function ue(e,t){return e.merge(o.fromJS(t))}function se(){return ie({result:"",entities:o.Map(),loading:!1,loaded:!1,updating:!1,updatedAt:0,error:null})}function ce(){return ie({result:[],entities:{},loading:!1,loaded:!1,updating:!1,updatedAt:0,error:null})}ae.decorators=[{type:t.NgModule,args:[{imports:[X,oe],exports:[X,oe],providers:[K,G]}]}],ae.ctorParameters=function(){return[]};var de=_.createSelectorCreator(_.defaultMemoize,o.is);var le=function(){return function(){this.production=!1,this.apiUrl="",this.throwOnSchemaError=!0,this.autoUpdate="always",this.updateMessage="A new version of the app is available. Do you want to reload the page to update?",this.pageTitle="DCS Angular Starter",this.base="/",this.additionalEnhancers=[],this.additionalMiddleware=[],this.additionalSettings={}}}(),pe=function(){function e(){}return e.prototype.handleError=function(e){throw localStorage.clear(),e},e}();e.MainBaseModule=k,e.NgxUtilsModule=ae,e.RestService=G,e.StableService=K,e.AppTranslateModule=X,e.LocaleService=Q,e.TranslateActions=Y,e.ContainerComponent=C,e.PresentationalComponent=I,e.random=function(){return 42},e.ReduxModule=oe,e.RootEpic=te,e.dummyEpic=ee,e.RootReducer=Z,e.generateAsyncActionNames=function(e){return{base:e,start:e+"_START",next:e+"_NEXT",error:e+"_ERROR"}},e.observableMiddleware=z,e.loggerMiddleware=J,e.removeEmptyActionsMiddleware=F,e.createNormalizedEntityState=se,e.normalizedEntityReducerFactory=function(e,t,r){var n=se();return function(a,i){void 0===a&&(a=n);var u,s=M(e,t),c=((u={})[s.readOneStart]=function(e,t){return ue(n,{loading:!0})},u[s.readOneNext]=function(e,t){return ue(e,{loading:!1,loaded:!0,updatedAt:Date.now(),entities:o.fromJS(t.payload.entities),result:t.payload.result})},u[s.readOneError]=function(e,t){return ue(n,{error:t.payload})},u[s.createStart]=function(e,t){return ue(e,{updating:!0,error:null})},u[s.createNext]=function(e,t){return ue(e,{updating:!1,loaded:!0,updatedAt:Date.now(),entities:o.fromJS(t.payload.entities),result:t.payload.result})},u[s.createError]=function(e,t){return ue(n,{updating:!1,error:t.payload})},u[s.updateStart]=function(e,t){return ue(e,{updating:!0,error:null})},u[s.updateNext]=function(e,t){return ue(e,{updating:!1,loaded:!0,updatedAt:Date.now(),entities:o.fromJS(t.payload.entities),result:t.payload.result})},u[s.updateError]=function(e,t){return ue(e,{updating:!1,error:t.payload})},u[s.deleteStart]=function(e,t){return ue(e,{updating:!0,error:null})},u[s.deleteNext]=function(e,t){return n},u[s.deleteError]=function(e,t){return ue(e,{updating:!1,error:t.payload})},u[s.setCurrent]=function(e,t){return ue(n,{loaded:!0,entities:o.fromJS(t.payload.entities),result:t.payload.result})},u[s.reset]=function(e,t){return n},u[s.resetError]=function(e,t){return e.set("error",null)},u),d=Object.assign({},c,r);return d[i.type]?d[i.type](a,i):a}},e.createNormalizedCollectionState=ce,e.normalizedCollectionReducerFactory=function(e,t,r){var n=ce();return function(a,i){void 0===a&&(a=n);var u,s=M(e,t),c=((u={})[s.readStart]=function(e,t){return ue(n,{loading:!0})},u[s.readNext]=function(e,t){return ue(e,{loading:!1,loaded:!0,updatedAt:Date.now(),entities:o.fromJS(i.payload.entities),result:i.payload.result})},u[s.readError]=function(e,t){return ue(n,{error:t.payload})},u[s.createStart]=function(e,t){return ue(e,{updating:!0,error:null})},u[s.createNext]=function(e,t){return ue(e,{updating:!1,entities:e.get("entities").mergeDeep(o.fromJS(t.payload.entities)),result:e.get("result").push(t.payload.result)})},u[s.createError]=function(e,t){return ue(e,{updating:!1,error:t.payload})},u[s.updateStart]=function(e,t){return ue(e,{updating:!0,error:null})},u[s.updateNext]=function(e,t){return ue(e,{updating:!1,entities:e.get("entities").mergeDeep(o.fromJS(t.payload.entities))})},u[s.updateError]=function(e,t){return ue(e,{updating:!1,error:t.payload})},u[s.deleteStart]=function(e,t){return ue(e,{updating:!0,error:null})},u[s.deleteNext]=function(t,r){return ue(t,{updating:!1,entities:t.get("entities").deleteIn([e,r.payload.result]),result:t.get("result").update(function(e){return e.filterNot(function(e){return e===r.payload.result})})})},u[s.deleteError]=function(e,t){return ue(e,{updating:!1,error:t.payload})},u[s.reset]=function(e,t){return n},u[s.resetError]=function(e,t){return e.set("error",null)},u),d=Object.assign({},c,r);return d[i.type]?d[i.type](a,i):a}},e.normalizedEntitySelectorFactory=function(e,t,r,n){void 0===n&&(n={});var o=function(t){return t.get(e)},a=function(e){return o(e).get("result")},i=de([a,function(e){return o(e).get("entities")}],function(e,n){if(e){var o=f.denormalize(e,r,n);return new t(o)}return new t});return Object.assign({},{subStateSelector:o,loadingSelector:function(e){return o(e).get("loading")},loadedSelector:function(e){return o(e).get("loaded")},updatingSelector:function(e){return o(e).get("updating")},updatedAtSelector:function(e){return o(e).get("updatedAt")},idSelector:a,modelSelector:i},n)},e.normalizedCollectionSelectorsFactory=function(e,t,r,n){void 0===n&&(n={});var a=function(t){return t.get(e)},i=function(e){return a(e).get("result")},u=de([i,function(e){return a(e).get("entities")}],function(e,n){return f.denormalize(e,r,n).map(function(e){return new t(e)})}),s=de([u],function(e){return e.reduce(function(e,t){return e.set(String(t.get("id",null)),t)},o.Map())});return Object.assign({},{subStateSelector:a,loadingSelector:function(e){return a(e).get("loading")},loadedSelector:function(e){return a(e).get("loaded")},updatingSelector:function(e){return a(e).get("updating")},updatedAtSelector:function(e){return a(e).get("updatedAt")},idsSelector:i,modelsSelector:u,modelsMapSelector:s},n)},e.generateCrudActionNames=M,e.subStateStale=D,e.hasModel=function(e,t,r,n){if(r=String(r),n){var o=e.get("updatedAt");if(!(Date.now()-o-n<0))return!1}return e.hasIn(["entities",t,r])},e.createImmutableState=ie,e.mergeState=ue,e.createSelector=de,e.createReduxStore=L,e.persistStateEnhancer=function(e){var t=i.withFilter(function(e){return!(e instanceof Error)});return a(e,{serialize:function(e){return t.toJSON(e)},deserialize:function(e){return t.fromJSON(e)},merge:function(e,t){return e.merge(t)},slicer:function(e){return function(t){return"string"==typeof e?t.filter(function(t,r){return r===e}):Array.isArray(e)?t.filter(function(t,r){return-1!==e.indexOf(r)}):t}}})},e.routerStateSelector=U,e.APP_REDUCERS=V,e.APP_EPICS=B,e.APP_ERROR_FORMATTERS=$,e.APP_TRANSLATIONS=H,e.APP_ENVIRONMENT=W,e.DefaultEnvironment=le,e.DefaultErrorHandler=pe,e.buildSchemaValidator=function(e,t){return t||(t=new j({allErrors:!0})),t.compile(e)},e.EmbeddedRecord=function(e){return function(t,r){var n=new WeakMap;return{get:function(){return n.has(this)||n.set(this,new e(this.get(r))),n.get(this)}}}},e.EmbeddedCollection=function(e,t){return void 0===t&&(t=o.List),function(r,n){var o=new WeakMap;return{get:function(){if(!o.has(this)){var r=this.get(n)||t();o.set(this,t(r.map(function(t){return new e(t)})))}return o.get(this)}}}},e.ExtendedRecord=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=o.fromJS(t.shift());return e.apply(this,q([n],t))||this}return function(e,t){function r(){this.constructor=e}T(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t.prototype["with"]=function(e){return this.merge(o.fromJS(e))},t}(e)},e.validateEmail=function(e){return w.isEmail(String(e.value))?null:{validateEmail:{valid:!1}}},e.validatePhone=function(e){return w.isMobilePhone(String(e.value),"de-DE")?null:{validatePhone:{valid:!1}}},e.validateFQDN=function(e){return w.isFQDN(String(e.value))?null:{validateFQDN:{valid:!1}}},e.validatePositiveInteger=function(e){var t=String(e.value);return w.isInt(t,{min:1})?null:{validatePositiveInteger:{valid:!1}}},e.validateDate=function(e){var t=A.parse(e.value,"YYYY-MM-DD",0);return A.isValid(t)?null:{validateDate:{valid:!1}}},e.validateTime=function(e){var t=A.parse(e.value,"HH:mm",0);return A.isValid(t)?null:{validateTime:{valid:!1}}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=dcs-ngx-utils.umd.min.js.map
